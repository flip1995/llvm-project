; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: %cheri_llc %s -o - | FileCheck %s
; ModuleID = 'capfail.c'

; Check that this doesn't crash SelectionDAG trying to fold the trunc into the
; load.

; CHECK: x
define i32 @x(i64 addrspace(200)* nocapture %capmem) #0 {
; CHECK-LABEL: x:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    cld $1, $zero, 0($c3)
; CHECK-NEXT:    jr $ra
; CHECK-NEXT:    sll $2, $1, 0
entry:
  %0 = load i64, i64 addrspace(200)* %capmem, align 8
  %conv = trunc i64 %0 to i32
  ret i32 %conv
}

attributes #0 = { nounwind readonly }

