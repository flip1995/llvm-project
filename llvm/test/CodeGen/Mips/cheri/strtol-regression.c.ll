; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: %cheri_llc %s -o - | FileCheck %s -check-prefixes CHECK,MIPS
; RUN: %cheri_purecap_llc %s -o - | FileCheck %s -check-prefixes CHECK,PURECAP
; ModuleID = '/Users/alex/cheri/llvm-project/clang/test/Sema/cheri/strtol-regression.c'
; This previously crashed due to the use of getPointerTy instead of getPointerRangeTy

; Check that we generate the same code as MIPS
define void @b(i8 %a) local_unnamed_addr addrspace(200) #0 {
; CHECK-LABEL: b:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    sll $1, $4, 0
; CHECK-NEXT:    andi $1, $1, 255
; CHECK-NEXT:    addiu $1, $1, -65
; CHECK-NEXT:    sltiu $3, $1, 38
; CHECK-NEXT:    dsll $2, $1, 32
; CHECK-NEXT:    beqz $3, .LBB0_2
; CHECK-NEXT:    nop
; CHECK-NEXT:  .LBB0_1: # %entry
; CHECK-NEXT:    dsrl $1, $2, 32
; CHECK-NEXT:    daddiu $2, $zero, 1
; CHECK-NEXT:    dsllv $1, $2, $1
; CHECK-NEXT:    daddiu $2, $zero, 63
; CHECK-NEXT:    dsll $2, $2, 32
; CHECK-NEXT:    daddiu $2, $2, 63
; CHECK-NEXT:    and $1, $1, $2
; CHECK-NEXT:    bnez $1, .LBB0_3
; CHECK-NEXT:    nop
; CHECK-NEXT:  .LBB0_2: # %if.end
; MIPS-NEXT:     jr $ra
; PURECAP-NEXT:  cjr $c17
; CHECK-NEXT:    nop
; CHECK-NEXT:  .LBB0_3: # %for.cond.preheader
; CHECK-NEXT:    .insn
entry:
  switch i8 %a, label %if.end [
    i8 102, label %for.cond.preheader
    i8 101, label %for.cond.preheader
    i8 100, label %for.cond.preheader
    i8 99, label %for.cond.preheader
    i8 98, label %for.cond.preheader
    i8 97, label %for.cond.preheader
    i8 70, label %for.cond.preheader
    i8 69, label %for.cond.preheader
    i8 68, label %for.cond.preheader
    i8 67, label %for.cond.preheader
    i8 66, label %for.cond.preheader
    i8 65, label %for.cond.preheader
  ]

for.cond.preheader:                               ; preds = %entry, %entry, %entry, %entry, %entry, %entry, %entry, %entry, %entry, %entry, %entry, %entry
  unreachable

if.end:                                           ; preds = %entry
  ret void
}
