// NOTE: Assertions have been autogenerated by utils/update_cc_test_checks.py
// RUN: %cheri128_purecap_cc1 %s -emit-llvm -O2 -o - | FileCheck %s
// RUN: %cheri128_purecap_cc1 %s -S -O2 -o - | FileCheck %s -check-prefix ASM
// REQUIRES: clang

struct addrinfo {
  char *b;
};

// CHECK-LABEL: @c(
// CHECK-NEXT:  entry:
// CHECK-NEXT:    [[RETVAL_SROA_0_0_A_ADDR_0__SROA_CAST:%.*]] = bitcast i8 addrspace(200)* [[A:%.*]] to i8 addrspace(200)* addrspace(200)*
// CHECK-NEXT:    [[RETVAL_SROA_0_0_COPYLOAD:%.*]] = load i8 addrspace(200)*, i8 addrspace(200)* addrspace(200)* [[RETVAL_SROA_0_0_A_ADDR_0__SROA_CAST]], align 1
// CHECK-NEXT:    [[DOTFCA_0_INSERT:%.*]] = insertvalue { i8 addrspace(200)* } undef, i8 addrspace(200)* [[RETVAL_SROA_0_0_COPYLOAD]], 0
// CHECK-NEXT:    ret { i8 addrspace(200)* } [[DOTFCA_0_INSERT]]
//
struct addrinfo c(char* a) {
  struct addrinfo d;
  __builtin_memcpy(&d, a, sizeof(struct addrinfo));
  return d;

// ASM:      clcbi	$c12, %capcall20(memcpy)($c1)
// ASM-NEXT: csetbounds	$c3, $c11, 16
// ASM-NEXT: cjalr	$c12, $c17
// ASM-NEXT: daddiu	$4, $zero, 16
}
