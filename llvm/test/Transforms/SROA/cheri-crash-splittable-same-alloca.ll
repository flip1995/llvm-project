; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --function-signature --scrub-attributes
; This test case previously triggered assertions in SROA ("Splittable transfers cannot reach the same alloca on both ends.")
; RUN: %cheri_purecap_opt -S -sroa %s -o - | FileCheck %s
source_filename = "/Users/alex/cheri/llvm-project/libcxx/test/std/containers/sequences/deque/deque.cons/iter_iter.pass.cpp"
target datalayout = "E-m:e-pf200:128:128:128:64-i8:8:32-i16:16:32-i64:64-n32:64-S128-A200-P200-G200"

%struct.a = type { %struct.b, %struct.b }
%struct.b = type { i32 addrspace(200)* }

define i32 addrspace(200)* @d(i32 addrspace(200)* %arg) addrspace(200) #0 {
; CHECK-LABEL: define {{[^@]+}}@d
; CHECK-SAME: (i32 addrspace(200)* [[ARG:%.*]]) addrspace(200)
; CHECK-NEXT:    ret i32 addrspace(200)* [[ARG]]
;
  %l = alloca %struct.a, align 16, addrspace(200)
  %dst.b = getelementptr %struct.a, %struct.a addrspace(200)* %l, i32 0, i32 0
  %src.b = getelementptr inbounds %struct.a, %struct.a addrspace(200)* %l, i32 0, i32 1
  %src.i32 = getelementptr inbounds %struct.b, %struct.b addrspace(200)* %src.b, i32 0, i32 0
  store i32 addrspace(200)* %arg, i32 addrspace(200)* addrspace(200)* %src.i32
  %dst.i8 = bitcast %struct.b addrspace(200)* %dst.b to i8 addrspace(200)*
  %src.i8 = bitcast %struct.b addrspace(200)* %src.b to i8 addrspace(200)*
  call void @llvm.memcpy.p200i8.p200i8.i64(i8 addrspace(200)* %dst.i8, i8 addrspace(200)* %src.i8, i64 16, i1 false)
  %dst.i32 = getelementptr inbounds %struct.b, %struct.b addrspace(200)* %dst.b, i32 0, i32 0
  %result = load i32 addrspace(200)*, i32 addrspace(200)* addrspace(200)* %dst.i32
  ret i32 addrspace(200)* %result
}

; Function Attrs: argmemonly nounwind willreturn
declare void @llvm.memcpy.p200i8.p200i8.i64(i8 addrspace(200)* noalias nocapture writeonly, i8 addrspace(200)* noalias nocapture readonly, i64, i1 immarg) addrspace(200) #1

; Function Attrs: argmemonly nounwind willreturn
declare void @llvm.lifetime.start.p200i8(i64 immarg, i8 addrspace(200)* nocapture) addrspace(200) #2

; Function Attrs: argmemonly nounwind willreturn
declare void @llvm.lifetime.end.p200i8(i64 immarg, i8 addrspace(200)* nocapture) addrspace(200) #2

attributes #0 = { nounwind }
attributes #1 = { argmemonly nounwind willreturn }
attributes #2 = { argmemonly nounwind willreturn }
